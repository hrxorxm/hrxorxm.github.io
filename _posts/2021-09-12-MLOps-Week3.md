---
layout: post
title:  "[MLOps Study] 3. ì½”ë“œ í’ˆì§ˆ, ë°ì´í„° ê²€ì¦, ëª¨ë¸ ë¶„ì„"
subtitle:   "Naver Boostcamp AI Tech êµ¬ì„±ì›ë“¤ê³¼ í•¨ê»˜í•˜ëŠ” MLOps ìŠ¤í„°ë””"
categories: "MLOps"
tags: []
use_math: true
---

# Week3

## ğŸ“ ì´ë²ˆ ì£¼ ëª©í‘œ

- [x] [Section 2] ì½”ë“œ í’ˆì§ˆ, ë°ì´í„° ê²€ì¦, ëª¨ë¸ ë¶„ì„
  - [x] (1) ë¦¬ì„œì¹˜ ì½”ë“œ í’ˆì§ˆ ê´€ë¦¬
  - [x] (2) ë°ì´í„° ê²€ì¦ - Tensorflow Data Validation
  - [x] (3) ë¨¸ì‹ ëŸ¬ë‹ ëª¨ë¸ ë¶„ì„ What if tool

## ğŸ“š ê°•ì˜ ë‚´ìš© ì •ë¦¬

### (1) ë¦¬ì„œì¹˜ ì½”ë“œ í’ˆì§ˆ ê´€ë¦¬

#### ë¦¬ì„œì¹˜ ì½”ë“œ í’ˆì§ˆ ë¬¸ì œ

* ë³µì‚¬ ë¶™ì—¬ë„£ê¸°ë¡œ ì¸í•œ ì½”ë“œ ì¤‘ë³µ -> ì½”ë“œ ì¬ì‚¬ìš©ì„±(ì¶”ìƒí™”, ë¼ì´ë¸ŒëŸ¬ë¦¬) ë†’ì´ê¸°
* relative importë¡œ ì¸í•´ ê¼¬ì¸ import -> absolute import ì‚¬ìš©í•˜ê¸°
  1. Standard library imports
  2. Related third party imports
  3. Local application/library specific imports
* ë²„ì „ê´€ë¦¬, ì‹¤í—˜ê´€ë¦¬ê°€ ì•ˆë˜ì„œ ì—°êµ¬ê²°ê³¼ ì¬ì—° ë¶ˆê°€ëŠ¥
* ë„ˆë¬´ ë§ì€ ì „ì—­ ë³€ìˆ˜, ëª…í™•í•˜ê¸° ì•Šì€ ë³€ìˆ˜ëª… ë“±

#### ë¦°íŠ¸, ìœ ë‹› í…ŒìŠ¤íŠ¸

* [`black`](https://pypi.org/project/black/) : indent, naming convention(snake_case)
* [`flake8`](https://pypi.org/project/flake8/) : python code linter tool
* [`mypy`](https://pypi.org/project/mypy/) : íƒ€ì… íŒíŠ¸(ex. `def fn(a: int) -> bool`)ì— ì˜¤ë¥˜ê°€ ì—†ëŠ”ì§€ ìë™ìœ¼ë¡œ í™•ì¸ ê°€ëŠ¥

#### ì§€ì†ì  í†µí•© ì‹¤ìŠµ

* ì§€ì†ì  í†µí•©(CI, Continuous Integration) : ì‘ì€ ë‹¨ìœ„ì˜ ì‘ì—…, ë¹ˆë²ˆí•œ í†µí•©
* Github Actions ì´ìš©í•˜ê¸°
* [[ì‹¤ìŠµ ë ˆí¬](https://github.com/chris-chris/research-ci-tutorial)]
  * [ë¦°íŠ¸ ì²´í¬](https://github.com/chris-chris/research-ci-tutorial/blob/main/.github/workflows/lint.yml)
  * [ìœ ë‹› í…ŒìŠ¤íŠ¸](https://github.com/chris-chris/research-ci-tutorial/blob/main/.github/workflows/coverage.yml) + [Code Climate](https://codeclimate.com/)
    * [Code Climate - Add Repo - Repo Settings - Test coverage] ì—ì„œ `TEST REPORTER ID` ë³µì‚¬í•œ í›„ `coverage.yml` ë‚´ì˜ `CODECLIMATE_REPO_TOKEN` ìˆ˜ì •í•˜ê¸°
      ```yaml
      name: Upload coverage to code climate
        env:
            CODECLIMATE_REPO_TOKEN: [MY TEST REPORTER ID]
        run: |
            codeclimate-test-reporter
      ```
    * [Code Climate - Repo Setting - GitHub] ì—ì„œ `PullÂ requestÂ comments`ë‚˜ `InlineÂ issueÂ comments`ë¥¼ í™œì„±í™”í•˜ë©´ ìë™ìœ¼ë¡œ ì½”ë“œì— ë¦¬ë·°ë¥¼ ë‹¬ì•„ì¤€ë‹¤.
    * README.md ì— ë±ƒì§€ ì¶”ê°€ë„ ê°€ëŠ¥
  * Settings - Branches - Branch protection rules [Add rule]
    - [x] Require status checks to pass before merging
      - [x] Require branches to be up to date before merging
  * ë¦°íŠ¸ì™€ ìœ ë‹› í…ŒìŠ¤íŠ¸ë¥¼ í†µê³¼í•˜ë„ë¡ ì½”ë“œë¥¼ ìˆ˜ì •í•´ì•¼ merge ê°€ëŠ¥!

### (2) ë°ì´í„° ê²€ì¦ : TFDV(TensorFlow Data Validation)

#### ë°ì´í„° ê²€ì¦ê³¼ TFDV

* ë°ì´í„° ê²€ì¦ì´ í•„ìš”í•œ ì´ìœ  : ë¨¸ì‹ ëŸ¬ë‹ ì‹œìŠ¤í…œì—ì„œ ë°ì´í„°ë¡œ ì¸í•œ ì¥ì• ëŠ” íŒŒì•…í•˜ê¸° ì–´ë µë‹¤.
* TFDV(TensorFlow Data Validation) : Framework Independent í•œ ì†”ë£¨ì…˜!
  * ê¸°ìˆ  í†µê³„ë³´ê¸°, ìŠ¤í‚¤ë§ˆ ì¶”ë¡ , ì´ìƒ í•­ëª© í™•ì¸ ë° ìˆ˜ì •
  * ë°ì´í„°ì…‹ ë“œë¦¬í”„íŠ¸ ë° ì™œê³¡  í™•ì¸
  * í›ˆë ¨, í‰ê°€ ë° ì œê³µ ë°ì´í„°ì…‹ì˜ ì¼ê´€ì„± í™•ì¸

#### TFDV ì‹¤ìŠµ

* [[ì‹¤ìŠµ ì½”ë“œ](https://github.com/tensorflow/tfx/blob/master/docs/tutorials/data_validation/tfdv_basic.ipynb)]
* í†µê³„ ê³„ì‚° ë° ì‹œê°í™”
  * í•™ìŠµ ë°ì´í„° í™•ì¸
    ```python
    train_stats = tfdv.generate_statistics_from_csv(data_location=TRAIN_DATA)
    tfdv.visualize_statistics(train_stats)
    ```
  * í‰ê°€ ë°ì´í„°ì˜ ì˜¤ë¥˜ í™•ì¸
    ```python
    eval_stats = tfdv.generate_statistics_from_csv(data_location=EVAL_DATA)
    tfdv.visualize_statistics(lhs_statistics=eval_stats, rhs_statistics=train_stats,
                              lhs_name='EVAL_DATASET', rhs_name='TRAIN_DATASET')
    ```
* ìŠ¤í‚¤ë§ˆ ì¶”ë¡ ê³¼ ìŠ¤í‚¤ë§ˆ í™˜ê²½
  * ìŠ¤í‚¤ë§ˆ ì¶”ë¡  : ê° featureì˜ ë°ì´í„° ìœ í˜•, ë¹ˆë„, ë„ë©”ì¸ ë“±
    ```python
    schema = tfdv.infer_schema(statistics=train_stats)
    tfdv.display_schema(schema=schema)
    ```
  * í‰ê°€ ë°ì´í„°ì˜ ì´ìƒ ë°ì´í„°(Anomaly) í™•ì¸
    ```python
    anomalies = tfdv.validate_statistics(statistics=eval_stats, schema=schema)
    tfdv.display_anomalies(anomalies)
    ```
  * ìŠ¤í‚¤ë§ˆì˜ í‰ê°€ ì´ìƒ ìˆ˜ì •
    ```python
    # ë„ë©”ì¸ì—ì„œ ê°€ì ¸ì™€ì•¼ í•˜ëŠ” ìµœì†Œ ë¹„ìœ¨ì˜ ê°’ ì™„í™”í•˜ê¸°
    company = tfdv.get_feature(schema, 'company')
    company.distribution_constraints.min_domain_mass = 0.9
    
    # ë„ë©”ì¸ì— ìƒˆ ê°’ ì¶”ê°€í•˜ê¸°
    payment_type_domain = tfdv.get_domain(schema, 'payment_type')
    payment_type_domain.value.append('Prcard')
    
    # ìŠ¤í‚¤ë§ˆ ë³€ê²½ í›„ ë‹¤ì‹œ í‰ê°€ ë°ì´í„°ì˜ ì´ìƒ í™•ì¸í•˜ê¸°
    updated_anomalies = tfdv.validate_statistics(eval_stats, schema)
    tfdv.display_anomalies(updated_anomalies)
    ```
  * ì œê³µ ë°ì´í„°ì˜ ì´ìƒ ë°ì´í„° í™•ì¸
    ```python
    options = tfdv.StatsOptions(schema=schema, infer_type_from_schema=True)
    serving_stats = tfdv.generate_statistics_from_csv(SERVING_DATA, stats_options=options)
    serving_anomalies = tfdv.validate_statistics(serving_stats, schema)
    tfdv.display_anomalies(serving_anomalies)
    ```
  * ìŠ¤í‚¤ë§ˆ í™˜ê²½ : ë¶„ë¦¬ëœ ë°ì´í„°ì…‹ì„ ìœ„í•œ ì•½ê°„ì˜ ìŠ¤í‚¤ë§ˆ ë³€í˜• ë„ì… (ex. ì§€ë„í•™ìŠµ ë ˆì´ë¸” í¬í•¨ ê´€ë ¨)
    ```python
    # TRAINING ê³¼ SERVING í™˜ê²½ì—ì„œ ëª¨ë‘ ê¸°ë³¸ì ìœ¼ë¡œ ì œê³µëœë‹¤.
    schema.default_environment.append('TRAINING')
    schema.default_environment.append('SERVING')
    
    # SERVING í™˜ê²½ì— 'tips' featureë¥¼ ë¬´ì‹œí•˜ë„ë¡ ì„¤ì •í•œë‹¤.
    tfdv.get_feature(schema, 'tips').not_in_environment.append('SERVING')
    
    # ë‹¤ì‹œ ì œê³µ ë°ì´í„°ì˜ ì´ìƒ í™•ì¸í•˜ê¸°
    serving_anomalies_with_env = tfdv.validate_statistics(
        serving_stats, schema, environment='SERVING')
    tfdv.display_anomalies(serving_anomalies_with_env)
    ```
  * ìŠ¤í‚¤ë§ˆ ê³ ì • (íŒŒì¼ë¡œ ì €ì¥)
    ```python
    from tensorflow.python.lib.io import file_io
    from google.protobuf import text_format
    
    file_io.recursive_create_dir(OUTPUT_DIR)
    schema_file = os.path.join(OUTPUT_DIR, 'schema.pbtxt')
    tfdv.write_schema_text(schema, schema_file)
    ```
* ë°ì´í„° ë“œë¦¬í”„íŠ¸ ë° ìŠ¤í
  * ë°ì´í„° ë“œë¦¬í”„íŠ¸ : ë²”ì£¼í˜•ì´ë‚˜ ì—°ì†í˜•ì— ëŒ€í•´ ë“œë¦¬í”„íŠ¸ê°€ í—ˆìš© ê°€ëŠ¥í•œ ê²ƒ(ì„ê³„ ê±°ë¦¬)ë³´ë‹¤ ë†’ì„ ë•Œ ê²½ê³ ë¥¼ ì¤„ ìˆ˜ ìˆë‹¤.
  * ìŠ¤í‚¤ë§ˆ ìŠ¤í(Schema Skew) : í•™ìŠµ ë° ì„œë¹™ ë°ì´í„°ê°€ ë™ì¼í•œ ìŠ¤í‚¤ë§ˆë¥¼ ë”°ë¥´ì§€ ì•Šì„ ë•Œ ë°œìƒ
  * íŠ¹ì„± ìŠ¤í(Feature Skew) : ëª¨ë¸ì´ í•™ìŠµí•˜ëŠ” íŠ¹ì„±ê°’ì´ ì„œë¹™ ì‹œì— í‘œì‹œë˜ëŠ” íŠ¹ì„±ê°’ê³¼ ë‹¤ë¥¼ ë•Œ ë°œìƒ
  * ë¶„í¬ ìŠ¤í(Distribution Skew) : í•™ìŠµ ë°ì´í„°ì…‹ì˜ ë¶„í¬ê°€ ì„œë¹™ ë°ì´í„°ì…‹ì˜ ë¶„í¬ì™€ í¬ê²Œ ë‹¤ë¥¼ ë•Œ ë°©ìƒ
    ```python
    # Add skew comparator for 'payment_type' feature.
    payment_type = tfdv.get_feature(schema, 'payment_type')
    payment_type.skew_comparator.infinity_norm.threshold = 0.01
    
    # Add drift comparator for 'company' feature.
    company=tfdv.get_feature(schema, 'company')
    company.drift_comparator.infinity_norm.threshold = 0.001
    
    skew_anomalies = tfdv.validate_statistics(train_stats, schema,
                                              previous_statistics=eval_stats,
                                              serving_statistics=serving_stats)
    tfdv.display_anomalies(skew_anomalies)
    ```

### (3) ë¨¸ì‹ ëŸ¬ë‹ ëª¨ë¸ ë¶„ì„ : WIT(What if tool)

#### What-If-Tool ì†Œê°œ

* ëª¨ë¸ ë¶„ì„ì„ ë°ì´í„°ì™€ ëª¨ë¸ ê´€ì ì—ì„œ í•´ì¤˜ì•¼ í•˜ëŠ”ë° ë””ë²„ê¹…ì´ ìƒë‹¹íˆ ì–´ë µë‹¤.
* [What-If-Tool](https://pair-code.github.io/what-if-tool/) : í›ˆë ¨ëœ ML ëª¨ë¸ì˜ ë™ì‘ì„ ë¶„ì„í•˜ëŠ” ì‹œê°í™” ê¸°ë°˜ ë„êµ¬
  * Datapointer Editor : ê°ê°ì˜ ë°ì´í„° í¬ì¸íŠ¸ë¥¼ í™•ì¸í•´ë³¼ ìˆ˜ ìˆë‹¤. ì˜ˆì¸¡ ê²°ê³¼ì˜ ë³€ê²½ë„ í™•ì¸ ê°€ëŠ¥í•˜ë‹¤.
  * Performance and Fairness : ê° featureë¥¼ ìŠ¬ë¼ì´ì‹±í•œ ëª¨ë¸ì˜ ì„±ëŠ¥(ex. ë‚˜ì´ëŒ€ë³„ ëª¨ë¸ ì •í™•ë„)ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ì–¼ë§ˆë‚˜ ë°ì´í„°ì˜ ë¶„í¬ê°€ ê³ ë¥´ê²Œ ë˜ì–´ìˆëŠ”ì§€ í™•ì¸ë„ ê°€ëŠ¥
  * Feature : TFDVì—ì„œ statì„ ë½‘ì•„ë³´ëŠ” ê²ƒê³¼ ìœ ì‚¬í•˜ë‹¤.
* Google Cloud AI ë¥¼ ì‚¬ìš©í•œë‹¤ë©´ ë°”ë¡œ ì—°ë™í•´ì„œ ì‹¤ì‹œê°„ìœ¼ë¡œ ëª¨ë¸ ë¶„ì„ì´ ê°€ëŠ¥í•˜ë‹¤.

#### What-If-Tool ëª¨ë¸ ë¶„ì„ ì‹¤ìŠµ

* [[ì‹¤ìŠµ ë‚´ìš©](https://pair-code.github.io/what-if-tool/learn/tutorials/walkthrough/) \| [ì‹¤ìŠµ ì½”ë“œ](https://link.chris-chris.ai/ai-lecture-13)]
  * ê°€ì¥ ê°€ê¹Œìš´ Counterfactuals íƒìƒ‰ : ë¶„ë¥˜ê°€ ì–´ë–»ê²Œ ë³€ê²½ë˜ëŠ”ì§€ í™•ì¸ ê°€ëŠ¥
  * ë¶€ë¶„ ì¢…ì†ì„± í”Œë¡¯ íƒìƒ‰
  * ëª¨ë¸ ì„±ëŠ¥ ë¶„ì„ : Confusion matrix, ROC curve ë“±
  * ë¹„ìš© ë¹„ìœ¨ ë° ê²°ì • ì„ê³„ê°’ ìµœì í™”
  * ë°ì´í„°ì…‹ì˜ ê° featureì— ëŒ€í•œ ê°’ ë¶„í¬
* [[Web demo](https://pair-code.github.io/what-if-tool/demos/image.html) \| [Notebook demo](https://colab.research.google.com/github/PAIR-code/what-if-tool/blob/master/WIT_Smile_Detector.ipynb)]

## ğŸ“¢ ìŠ¤í„°ë”” ë¯¸íŒ…

* [huggingface datasets](https://github.com/huggingface/datasets)
* [êµ¬ê¸€ AI ì—ì½”ì‹œìŠ¤í…œ](https://ai.google/tools/)

## ğŸš€ í•™ìŠµ íšŒê³ 

* ë‹¤ë¥¸ ë‚´ìš©ì€ ì¡°ê¸ˆ ë‚®ì„¤ì§€ë§Œ GitHub Actionì€ í”„ë¡œì íŠ¸í•  ë•Œ ë°”ë¡œ ì ìš©í•´ì„œ í•´ë³¼ë§Œí•œ ê²ƒ ê°™ë‹¤!


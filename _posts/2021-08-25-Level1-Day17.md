---
layout: post
title:  "[Boostcamp AI Tech] 17ì¼ì°¨ í•™ìŠµì •ë¦¬"
subtitle:   "Naver Boostcamp AI Tech Level1 Day17"
categories: "Boostcamp-AI-Tech"
tags: [4ì£¼ì°¨]
use_math: true
---

# ë¶€ìŠ¤íŠ¸ìº í”„ 17ì¼ì°¨

## ğŸ“ ì˜¤ëŠ˜ ì¼ì • ì •ë¦¬

* 8/25 (ìˆ˜)
  - [x] ì´ë¯¸ì§€ ë¶„ë¥˜ ê°•ì˜
    - [x] (5ê°•) Model 1
    - [x] (6ê°•) Model 2
  - [x] ìŠ¤í˜ì…œ ë¯¸ì…˜ : Model

## ğŸ“š ê°•ì˜ ë‚´ìš© ì •ë¦¬

### [5ê°•] Model 1 - Model with Pytorch

* Pytorch : Low-level, Pythonic, Flexibility
* Pytorch ëª¨ë¸ì˜ ëª¨ë“  ë ˆì´ì–´ëŠ” `nn.Module` í´ë˜ìŠ¤ë¥¼ ë”°ë¥¸ë‹¤.
  * `model.modules()`
    * `__init__()` ì—ì„œ ì •ì˜í•œ ë˜ ë‹¤ë¥¸ `nn.Module`
    * ëª¨ë¸ì„ ì •ì˜í•˜ëŠ” ìˆœê°„ ê·¸ ëª¨ë¸ì— ì—°ê²°ëœ ëª¨ë“  moduleì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
  * `forward()`
    * ì´ ëª¨ë¸ì´ í˜¸ì¶œë˜ì—ˆì„ ë•Œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜
    * ëª¨ë“  `nn.Module`ì€ `forward()` í•¨ìˆ˜ë¥¼ ê°€ì§€ë¯€ë¡œ, ë‚´ê°€ ì •ì˜í•œ ëª¨ë¸ì˜ `forward()` ì‹¤í–‰ìœ¼ë¡œ ê°ê°ì˜ ëª¨ë“ˆì˜ `forward()`ê°€ ì‹¤í–‰ëœë‹¤.
  * Parameters
    * ëª¨ë¸ì— ì •ì˜ë˜ì–´ ìˆëŠ” modulesê°€ ê°€ì§€ê³  ìˆëŠ”, ê³„ì‚°ì— ì“°ì¼ Parameter
    * data, grad, requires_grad ë³€ìˆ˜ ë“±ì„ ê°€ì§€ê³  ìˆë‹¤.
* Pythonic : (ex) `model.state_dict()`ëŠ” Python ì˜ Dictionaryì´ë‹¤.

### [6ê°•] Model 2 - Pretrained Model

* ImageNet : ëŒ€ìš©ëŸ‰ì˜ ë°ì´í„°ì…‹ ë•ë¶„ì— ì»´í“¨í„° ë¹„ì „ì´ ë°œì „í•  ìˆ˜ ìˆì—ˆë‹¤.
* Pretrained Model
  * ëª©ì  : ì¢‹ì€ í’ˆì§ˆ, ëŒ€ìš©ëŸ‰ì˜ ë°ì´í„°ë¡œ ë¯¸ë¦¬ í•™ìŠµí•œ ëª¨ë¸ì„ ë‚´ ëª©ì ì— ë§ê²Œ ë‹¤ë“¬ì–´ì„œ ì‚¬ìš©
  * `torchvision.models` / `timm`
* Transfer Learning
  * CNN base : Input + CNN Backbone + Classifier(fc) -> Output
  * Backbone ëª¨ë¸ì˜ taskì™€ í˜„ì¬ taskì˜ ìœ ì‚¬ì„±ì„ ê³ ë ¤í•˜ì—¬ í•™ìŠµí•œë‹¤.
    * High Similarity : CNN Backboneì„ Freezeí•˜ê³  Classiferë§Œ í•™ìŠµì‹œí‚¨ë‹¤. (Feature extraction ë°©ì‹)
    * Low Similarity : ì „ì²´ ë„¤íŠ¸ì›Œí¬ë¥¼ í•™ìŠµì‹œí‚¨ë‹¤. (Fine-tuning ë°©ì‹)
* ì¶”ê°€ ìë£Œ
  * [7 Tips To Maximize PyTorch Performance](https://towardsdatascience.com/7-tips-for-squeezing-maximum-performance-from-pytorch-ca4a40951259)
    * DataLoader
      * `num_workers = 4 * num_GPU`
      * `pin_memory =Â True` & `torch.cuda.empty_cache()`
    * `.cpu()` / `.item()` / `.numpy()` ëŠ” ì„±ëŠ¥ì´ ë§¤ìš° ëŠë¦¬ë¯€ë¡œ GPU ìƒì—ì„œ ê³„ì‚° ê·¸ë˜í”„ì—ì„œë§Œ ë¶„ë¦¬í•˜ê³  ì‹¶ì„ ë•ŒëŠ” `.detach()` ë¥¼ ì‚¬ìš©í•˜ì
    * `.cuda()` í•˜ì§€ ë§ê³ , tensorë¥¼ ë§Œë“¤ ë•Œ deviceë¥¼ ì§€ì •í•´ì£¼ì
  * [Most Common Neural Net PyTorch Mistakes](https://medium.com/missinglink-deep-learning-platform/most-common-neural-net-pytorch-mistakes-456560ada037)
    * train / eval ëª¨ë“œ ë°”ê¿”ì£¼ëŠ” ê²ƒ ì£¼ì˜í•˜ì
    * `backward()` ì „ì— `zero_grad()` í•´ì£¼ëŠ” ê²ƒ ìŠì§€ ë§ì

## ğŸ” ë¯¸ì…˜ ìˆ˜í–‰ ê³¼ì •

* ResNet ëª¨ë¸ êµ¬ì¡° ì§ì ‘ êµ¬í˜„í•´ë³´ê¸°
* Pretrained Model
  * Fine-tuning í•´ë³´ê¸°
  * Feature Extraction í•´ë³´ê¸°

## ğŸŒ± í”¼ì–´ ì„¸ì…˜ ì •ë¦¬

* ë§ˆìŠ¤í¬ ì°©ìš© ìƒíƒœ ë¶„ë¥˜ ëŒ€íšŒëŠ” ImageNet task í•˜ê³  ë‹¤ë¥¸ ê²ƒ ê°™ë‹¤.
  * Pretrained modelì„ Freeze ì•ˆ í•˜ê³  ëŒë¦¬ëŠ”ê²Œ ë‚˜ì„ ê²ƒ ê°™ë‹¤.
  * ë°±ë³¸ ëª¨ë¸ ìì²´ë¥¼ ìš°ë¦¬ taskë‘ ë¹„ìŠ·í•œ taskë¥¼ í•™ìŠµì‹œí‚¨ ëª¨ë¸ë¡œ ê°€ì ¸ì™€ë³´ì ex) ê³ ì–‘ì´ ì¢…ë¥˜ ë¶„ë¥˜
* [Albumentations ì˜ˆì‹œ](https://github.com/albumentations-team/albumentations_examples/blob/master/notebooks/migrating_from_torchvision_to_albumentations.ipynb)
  ```python
  albumentations_transform = A.Compose([
      A.Resize(256, 256), 
      A.CenterCrop(224, 224),
      A.HorizontalFlip(),
      A.Normalize(
          mean=[0.485, 0.456, 0.406],
          std=[0.229, 0.224, 0.225],
      ),
      ToTensorV2()
  ])
  ```
  * [RandomAugmentation](https://arxiv.org/abs/1909.13719) : https://github.com/ildoonet/pytorch-randaugment/blob/master/RandAugment/data.py
* ë°ì´í„° ë¶ˆê· í˜• í•´ê²° ë°©ì•ˆ
  * [imbalanced-learn](https://imbalanced-learn.org/stable/)
  * [torchsampler](https://github.com/ufoym/imbalanced-dataset-sampler)

## ğŸš€ í•™ìŠµ íšŒê³ 

* ë§ˆìŠ¤í¬, ì„±ë³„, ë‚˜ì´ ë¶„ë¥˜ ëª¨ë¸ì´ ê°ê° 90%ê°€ ë„˜ì–´ë„ ë ˆì´ë¸”ë§Œ í•©ì¹˜ë©´ ì„±ëŠ¥ì´ ë³„ë¡œê³ , ë ˆì´ë¸”ì„ 18ê°œë¡œ í•´ë†“ê³  lossë¥¼ êµ¬í–ˆë˜ ëª¨ë¸ì´ ê·¸ë‚˜ë§ˆ ì„±ëŠ¥ì´ ê´œì°®ì•˜ë‹¤.
* ì„œë²„ì—ì„œ ë…¸íŠ¸ë¶íŒŒì¼ ë³µì‚¬í•´ì„œ ì˜¬ë¦¬ë©´ ìê¾¸ ì…€ë“¤ì´ ì§€ì›Œì§€ê±°ë‚˜ ìˆœì„œê°€ ë°”ë€ì±„ë¡œ ì˜¬ë¼ê°„ë‹¤. íŒŒì´ì¬ í…œí”Œë¦¿ìœ¼ë¡œ ì˜®ê²¨ì•¼ê² ë‹¤.
* efficientnet-b3ìœ¼ë¡œ í•™ìŠµí•œ ê²°ê³¼ê°€ ì§€ê¸ˆ íŒ€ ë‚´ 1ë“±ì¸ë°, inception-resnet-v2ë„ ê·¼ì†Œí•œ ì°¨ì´ë¡œ 2ë“±ì´ë‹¤. ì•™ìƒë¸” ëª¨ë¸ì´ ì•„ë‹ˆë©´ ë” ì´ìƒ ëª¨ë¸ì„ ê°ˆì•„ë¼ì›Œì„œëŠ” ì„±ëŠ¥ì„ ë†’ì´ê¸° ì–´ë ¤ìš¸ ê²ƒ ê°™ë‹¤.
* ì˜¤ëŠ˜ í•œ ì¼ : ì—¬ëŸ¬ ëª¨ë¸ ì‹œë„, augmentation ê°„ë‹¨í•˜ê²Œ ì‹œë„
* ë‚´ì¼ ëª©í‘œ : í…œí”Œë¦¿ìœ¼ë¡œ ì˜®ê¸°ê¸°, ì‹¤í—˜ê´€ë¦¬ íˆ´ ì‚¬ìš©í•˜ê¸°, ì•™ìƒë¸” ì‹œë„í•˜ê¸°

